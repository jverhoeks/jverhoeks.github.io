


<!DOCTYPE html>
<html lang="en-us">

  <head>
    
    

    
    
  <link href="http://gmpg.org/xfn/11" rel="profile">

    
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
  <meta name="description" content="Jacobs Tech Blog Tech, Cloud and Programming">


    
    
<title>
    
    Zola, Github Pages and CloudFlare &middot; Jacobs Tech Blog
    
</title>



    
  <!-- CSS -->
  <link rel="stylesheet" href="https:&#x2F;&#x2F;jacob.verhoeks.org/main.css">
  <script src="https://kit.fontawesome.com/ac557d6010.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <script src="https://getinsights.io/js/insights.js"></script>
  <script>
  insights.init('t6rLVGW6KcRuQdn8');
  insights.trackPages();
  </script>


    
<meta name="theme-color" content="#ffffff">

  <!-- Icons -->
  <link rel="shortcut icon" href="https:&#x2F;&#x2F;jacob.verhoeks.org/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="https://jacob.verhoeks.org/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://jacob.verhoeks.org/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://jacob.verhoeks.org/favicon-16x16.png">


    

  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">


	


	



    



    
  

  



  



  










	


	


<link rel="canonical" href="https://jacob.verhoeks.org/zola-github-pages/">



  <meta name="twitter:card" content="summary_large_image">
  
    <meta name="twitter:image" content="https://jacob.verhoeks.org/&#x2F;apple-touch-icon.png">
  
  <meta name="twitter:title" content="Zola, Github Pages and CloudFlare">
  <meta name="twitter:description" content="Tech, Cloud and Programming">
  <meta name="twitter:site" content="@zamwan">
  <meta name="twitter:creator" content="@zamwan">

  <meta property="og:title" content="Zola, Github Pages and CloudFlare">
  <meta property="og:description" content="Tech, Cloud and Programming">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://jacob.verhoeks.org/zola-github-pages/">

  
    <meta property="og:image" content="https://jacob.verhoeks.org/&#x2F;apple-touch-icon.png">
  

  <meta property="og:updated_time" content="2021-05-01T08:08:08+08:00">
  <meta property="og:site_name" content="Zola, Github Pages and CloudFlare">

  

  

  
  <meta property="og:locale" content="en_US">



  
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "/zola-github-pages/",
      "name": "Zola, Github Pages and CloudFlare",
      "logo": "/zola-github-pages/logo-doks.png",
      "sameAs": [
        "https://twitter.com/zamwan",
        "https://www.linkedin.com/in/jacobverhoeks/",
        "https://github.com/jverhoeks"
      ]
    }
    </script>
  
  
  







<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
    
      
      
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://jacob.verhoeks.org/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Zola Github Pages",
            "item": "https://jacob.verhoeks.org/zola-github-pages/"
          }
        
      
    
   ]
  }
</script>



    
  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">


    
  
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_SVG"> </script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });
  </script>
  

  </head>

  <body>

    
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
        styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

    <!-- Toggleable sidebar -->
    <div class="sidebar" id="sidebar">
      
  <div class="sidebar-item">
    <div class="sidebar-personal-info">
      <div class="sidebar-personal-info-section">
        <a href="https://gravatar.com/2ec5bb1c3a7caaeff2a4e57872a28f85">
          <img src="https://www.gravatar.com/avatar/2ec5bb1c3a7caaeff2a4e57872a28f85?s=350" title="View on Gravatar" alt="View on Gravatar" />
        </a>
      </div>
      <div class="sidebar-personal-info-section">
        <p>üá≥üá± Cloud Architect & AWS Community Builder</p>
      </div>
      
      
      
      <div class="sidebar-personal-info-section">
        <p> Follow me: <br />
        
        
        
        <a href="https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;jacobverhoeks&#x2F;">
          <i class="fa fa-linkedin" aria-hidden="true"></i>
        </a>
        
        |
        
        
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;jverhoeks">
          <i class="fa fa-github" aria-hidden="true"></i>
        </a>
        
        |
        
        
        
        <a href="https:&#x2F;&#x2F;twitter.com&#x2F;zamwan">
          <i class="fa fa-twitter" aria-hidden="true"></i>
        </a>
        
        |
        
        </p>
      </div>
      
    </div>
  </div>
 

      
   
  <nav class="sidebar-nav">
    
      
      
      
        
      

      <span class="">
        <a class="sidebar-nav-item " href="https:&#x2F;&#x2F;jacob.verhoeks.org&#x2F;">
          Home
        </a>

        
      </span>

    
      
      
      
        
      

      <span class="">
        <a class="sidebar-nav-item " href="https:&#x2F;&#x2F;jacob.verhoeks.org&#x2F;categories&#x2F;">
          Categories
        </a>

        
      </span>

    
      
      
      
        
      

      <span class="">
        <a class="sidebar-nav-item " href="https:&#x2F;&#x2F;jacob.verhoeks.org&#x2F;tags&#x2F;">
          Tags
        </a>

        
      </span>

    
      
      
      
        
      

      <span class="">
        <a class="sidebar-nav-item " href="https:&#x2F;&#x2F;jacob.verhoeks.org&#x2F;about&#x2F;">
          About
        </a>

        
      </span>

    
  </nav>



      
  <div class="sidebar-item">
    <div class="sidebar-personal-info">
      <div class="sidebar-personal-info-section">
        <a href="https://aws.amazon.com/developer/community/community-builders/">
          <img src="/img/cb-badge.png" title="AWS Community Builders" alt="AWS Community Builders" />
        </a>
      </div>
    </div>
  </div>
 

      
  <div class="sidebar-item sidebar-item-last">
    <p>
    &copy; 2022 Jacob Verhoeks. This work is licensed under <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a>.
    </p>
  </div>



    </div>
    

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">

      

      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https:&#x2F;&#x2F;jacob.verhoeks.org/" title="Home" title="Jacobs Tech Blog">
              <img class="masthead-logo" src="https:&#x2F;&#x2F;jacob.verhoeks.org&#x2F;logo2.png" alt="logo"/>
            </a>
            <small>Tech, Cloud and Programming</small>
            
          </h3>
        </div>
      </div>



      <div class="container content">

        
	      <div class="post">
          <h1 class="post-title">Zola, Github Pages and CloudFlare</h1>
          <span class="post-date">2022-01-26</span>

           |
            
            <a href="https://jacob.verhoeks.org/tags/zola/" class="post-tag">zola</a>
            
            <a href="https://jacob.verhoeks.org/tags/github/" class="post-tag">github</a>
            
            <a href="https://jacob.verhoeks.org/tags/cloudflare/" class="post-tag">cloudflare</a>
            
          
          <article>
            <h1 id="a-blog">A Blog..</h1>
<p>It's time to start sharing again interesting things on my own website. A.k.a. blogging, but then how?</p>
<p>The important things for me:</p>
<ul>
<li>Full control ,not a 3rd service like medium</li>
<li>Open source products</li>
<li>Easy to write and quick to publish</li>
<li>Avoid html/css/js as much as i can while writing</li>
<li>Fast &amp; Responsive website </li>
<li>Free (very cheap)</li>
</ul>
<span id="continue-reading"></span>
<p>I decided on a markdown based static website generator. I got some bad experiences with Hugo and Jekyll (Rubyüò≥) from previous projects.
The final decision was between <a rel="noopener" target="_blank" href="https://vuepress.vuejs.org/">VuePress</a> and <a rel="noopener" target="_blank" href="https://www.getzola.org/">Zola</a>. Having worked with VuepPess a lot, i choose the new technology, Zola. </p>
<h2 id="zola">Zola</h2>
<p>Zola is a &quot;blazing&quot; fast generator written in Rust. It's builds the whole website under a second. 
With Content in Markdown, templates in HTML with <a rel="noopener" target="_blank" href="https://tera.netlify.app/">Tera</a></p>
<p>Created a quick demo</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>zola init myblog 
</span></code></pre>
<p>Answer a few questions </p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>&gt; What is the URL of your site? (https://example.com):
</span><span>&gt; Do you want to enable Sass compilation? [Y/n]:
</span><span>&gt; Do you want to enable syntax highlighting? [y/N]:
</span><span>&gt; Do you want to build a search index of the content? [y/N]:
</span></code></pre>
<p>The basic layout is then</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>‚îú‚îÄ‚îÄ config.toml
</span><span>‚îú‚îÄ‚îÄ content/
</span><span>‚îÇ   ‚îî‚îÄ‚îÄ blog/
</span><span>‚îÇ       ‚îú‚îÄ‚îÄ _index.md
</span><span>‚îÇ       ‚îú‚îÄ‚îÄ first.md
</span><span>‚îÇ       ‚îî‚îÄ‚îÄ second.md
</span><span>‚îú‚îÄ‚îÄ sass/
</span><span>‚îú‚îÄ‚îÄ static/
</span><span>‚îú‚îÄ‚îÄ templates/
</span><span>‚îÇ   ‚îú‚îÄ‚îÄ base.html
</span><span>‚îÇ   ‚îú‚îÄ‚îÄ blog-page.html
</span><span>‚îÇ   ‚îú‚îÄ‚îÄ blog.html
</span><span>‚îÇ   ‚îî‚îÄ‚îÄ index.html
</span><span>‚îî‚îÄ‚îÄ themes/
</span></code></pre>
<p>It has a local webserver for live testing/editting <code>zola serve</code> and open it at: <code>http://127.0.0.1:1111</code></p>
<p>Add a theme of your linking from the <a rel="noopener" target="_blank" href="https://www.getzola.org/themes/">gallery</a>. I'm using <a rel="noopener" target="_blank" href="https://github.com/svavs/codinfox-zola">codinfox-zola</a>. With some modifications</p>
<h2 id="github-repository">Github repository</h2>
<p>To store the website i use GitHub. With private repo's on the free tier it's easy to use. 
I added a <code>.gitignore</code> to avoid any locally generated content to be uploaded.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>public/
</span></code></pre>
<h2 id="cloudflare">CloudFlare</h2>
<p>CloudFlare is a CDN with a free-tier, that's very generous and more then enough for a personal blog. 
I registered by Domain with CloudFlare, they are one of the cheapest registrars and started to setup.</p>
<p>Next i wanted to use <a rel="noopener" target="_blank" href="https://pages.cloudflare.com/">Pages</a>. It's a website hosting service that combines static hosting with fast interactive software.
This can be compared with AWS S3 and Lambda, but then all in 1 &quot;easy&quot; to use interface. Besides static generators it also supports react,next.js and others.</p>
<p>There is Zola support, so i thought that's easy: connect CloudFlare with Github and let it build.
But the build image is missing the zola binary. :(  I notified cloudflare, but i went for a workaround</p>
<h2 id="github-pages">GitHub Pages</h2>
<p>I could choose AWS S3, but then you might run into some costs. My accounts all are out of free-tier. So i went for <a rel="noopener" target="_blank" href="https://pages.github.com/">GitHub pages</a>.
A simple/free way to have a public repo as webserver. </p>
<ol>
<li>Create a repo named: <code>username.github.io</code></li>
<li>Upload at least a index.html to the main branch </li>
<li>Open <code>https://username.github.io</code></li>
</ol>
<p>To use it with Zola, run <code>zola build</code> and copy the output in the <code>public\</code> directory to the username.github.io repo and push to the main branch
Your mini website should be reachable now.</p>
<h2 id="your-own-domain-name">Your own domain name</h2>
<p>While the github.io domain isn't that bad, we want to use our own registered domain. 
CloudFlare makes this very easy. </p>
<ul>
<li>Open your domain</li>
<li>Edit DNS</li>
<li>Create record <code>blog</code> as CNAME and have a target: <code>username.github.io</code>, make sure the proxy switch is enabled.</li>
</ul>
<p>Now, after the dns is available you can go to https://blog.yourdomain.com. Unfortunately this gives an error page. 
This comes from github who doesn't know which page to load. The solution is to add a special file in the root directory. <a rel="noopener" target="_blank" href="https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/about-custom-domains-and-github-pages">Github</a></p>
<p>For Zola, create a file named <code>CNAME</code>  with content: <code>blog.yourdomain.com</code> and place it in the <code>static</code> directory.
Every time you build zola the file is copied to the public/ directory and makes it work. 
Deploy the website and test it again.</p>
<p>CloudFlare is a caching proxy, it keeps pages a certain amount time in it's memory before it gets a new version from the server.
To force this, run a <a rel="noopener" target="_blank" href="https://developers.cloudflare.com/cache/how-to/purge-cache">purge</a> in cloudflare.</p>
<h2 id="automation">Automation</h2>
<p>When we push to the main branch in our website repo do the following actions:</p>
<ol>
<li>Test and Build the zola website</li>
<li>Upload the <code>public\</code> directory to the <code>username.github.io</code> repo </li>
<li>Purge the cloudflare cache </li>
</ol>
<p>Create a <a rel="noopener" target="_blank" href="https://docs.github.com/en/actions/using-workflows/triggering-a-workflow">github workflow</a> to run these actions</p>
<ul>
<li><a rel="noopener" target="_blank" href="https://github.com/shalzz/zola-deploy-action">https://github.com/shalzz/zola-deploy-action</a></li>
<li><a rel="noopener" target="_blank" href="https://github.com/jakejarvis/cloudflare-purge-action">https://github.com/jakejarvis/cloudflare-purge-action</a></li>
</ul>
<h3 id="secrets">Secrets</h3>
<p>We need credentials to talk with github and cloudflare. There are stored in github <a rel="noopener" target="_blank" href="https://docs.github.com/en/actions/security-guides/encrypted-secrets">secrets</a></p>
<p>To create the cloudflare token, go <a rel="noopener" target="_blank" href="https://dash.cloudflare.com/profile/api-tokens">here</a>.</p>
<p>Create Token</p>
<ul>
<li>Name: github purge token</li>
<li>Type: Custom</li>
<li>Permissions: Zone , Cache Purge</li>
<li>Zone Resources: include, specific zone, yourdomain.com </li>
</ul>
<p>Safe the token in the github secret: <code>CLOUDFLARE_TOKEN</code></p>
<p>Find the Zone Id in the zone page and store in <code>CLOUDFLARE_ZONE</code></p>
<p>Github <a rel="noopener" target="_blank" href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">Personal Access Token</a>.</p>
<ul>
<li>Click your account</li>
<li>Settings -&gt; Developer Settings  -&gt; Personal access token </li>
<li>Generate </li>
<li>Expire: 6months / or more</li>
<li>Permissions:  Repo: status, Repo_deployment, public_repo </li>
</ul>
<p>Save the token in the secret: <code>PUBLIC_TOKEN</code></p>
<p>Create the workflow file to combine all <code>.github/workflows/main.yml</code></p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>on: push
</span><span>jobs:
</span><span>  build_and_deploy:
</span><span>    runs-on: ubuntu-latest
</span><span>    if: github.ref == &#39;refs/heads/main&#39;
</span><span>    steps:
</span><span>      - name: &#39;checkout&#39;
</span><span>        uses: actions/checkout@v2
</span><span>      - name: &#39;build and deploy&#39;
</span><span>        uses: shalzz/zola-deploy-action@v0.13.0
</span><span>        env:
</span><span>          PAGES_BRANCH: master
</span><span>          BUILD_DIR: .
</span><span>          TOKEN: ${{ secrets.PUBLIC_TOKEN }}
</span><span>          REPOSITORY: jverhoeks/jverhoeks.github.io
</span><span>      - name: Purge cache
</span><span>        uses: jakejarvis/cloudflare-purge-action@master
</span><span>        env:
</span><span>          # Zone is required by both authentication methods
</span><span>          CLOUDFLARE_ZONE: ${{ secrets.CLOUDFLARE_ZONE }}
</span><span>          CLOUDFLARE_TOKEN: ${{ secrets.CLOUDFLARE_TOKEN }}
</span></code></pre>
<p>Push a change to your website repo main branch and watch the <code>actions</code>  tab in the github website.
You can see the steps checkout, build and deploy, purge cache and view the result. All should be right and the website will the updated automatic.</p>
<p>This was the first article, time for some more. üòÅ</p>

          </article>
        </div>

        <div class="related">
          <h2>Other Posts</h2>
          <ul class="related-posts">
            <li class="previous">
            
            </li>
            <li class="next">
            
            </li>
          </ul>
        </div>

        


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"> </label>

    
    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        // set default sidebar if widescreen
        if(window.innerWidth > 1400)
          checkbox.checked = true;

        window.addEventListener('resize',function(e) {
          if(window.innerWidth > 1400 && !checkbox.checked )
              checkbox.checked = true;  
          if(window.innerWidth < 1400 && checkbox.checked )
              checkbox.checked = false;  
        },true);


        document.addEventListener('click', function(e) {
          var target = e.target;

          if (target === toggle) {
            checkbox.checked = !checkbox.checked;
            e.preventDefault();
          } else if (checkbox.checked && !sidebar.contains(target)) {
            /* click outside the sidebar when sidebar is open */
            checkbox.checked = false;
          }
        }, false);
      })(document);
    </script>



  </body>

  
 


</html>
